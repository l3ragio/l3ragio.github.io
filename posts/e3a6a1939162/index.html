<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Babuk v4 Ransomware" /><meta name="author" content="Davide Bragetti" /><meta property="og:locale" content="en" /><meta name="description" content="Background summary and technical sample analysis" /><meta property="og:description" content="Background summary and technical sample analysis" /><link rel="canonical" href="https://l3ragio.github.io/posts/e3a6a1939162/" /><meta property="og:url" content="https://l3ragio.github.io/posts/e3a6a1939162/" /><meta property="og:image" content="https://l3ragio.github.io/assets/e3a6a1939162/1*hm0UuYYti5dx_6HzMF1BNQ.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-15T14:51:45+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://l3ragio.github.io/assets/e3a6a1939162/1*hm0UuYYti5dx_6HzMF1BNQ.png" /><meta property="twitter:title" content="Babuk v4 Ransomware" /><meta name="twitter:site" content="@l3rag1" /><meta name="twitter:creator" content="@Davide Bragetti" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Davide Bragetti"},"dateModified":"2023-08-01T19:56:17+02:00","datePublished":"2022-08-15T14:51:45+02:00","description":"Background summary and technical sample analysis","headline":"Babuk v4 Ransomware","image":"https://l3ragio.github.io/assets/e3a6a1939162/1*hm0UuYYti5dx_6HzMF1BNQ.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://l3ragio.github.io/posts/e3a6a1939162/"},"url":"https://l3ragio.github.io/posts/e3a6a1939162/"}</script><title>Babuk v4 Ransomware |</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-93KB79VZT8"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-93KB79VZT8'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/"></a><p class="site-subtitle fst-italic mb-0"></p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/visual-stories/" class="nav-link"> <i class="fa-fw ðŸ“š"></i> <span>VISUAL STORIES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw "></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/l3ragio" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/l3rag1" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['bragettidavide','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Babuk v4 Ransomware</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Babuk v4 Ransomware</h1><p class="post-desc fw-light mb-4">Background summary and technical sample analysis</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1660567905" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 15, 2022 </time> </span> <span> Updated <time data-ts="1690912577" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 1, 2023 </time> </span><div class="mt-3 mb-3"> <a href="/assets/e3a6a1939162/1*hm0UuYYti5dx_6HzMF1BNQ.png" class="popup img-link preview-img shimmer"><img src="/assets/e3a6a1939162/1*hm0UuYYti5dx_6HzMF1BNQ.png" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2431 words" > <em>13 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Babuk v4 Ransomware</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Babuk v4 Ransomware</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h3 id="babuk-v4-ransomware"><span class="me-2">Babuk v4 Ransomware</span><a href="#babuk-v4-ransomware" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="background-summary-and-technical-sample-analysis"><span class="me-2">Background summary and technical sample analysis</span><a href="#background-summary-and-technical-sample-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Babuk is a ransomware threat <a href="https://twitter.com/arkbird_solg/status/1345569395725242373?s=21" target="_blank">discovered in 2021</a> that attacked at least five big enterprises. The ransomware group behind it follows the Big-Game hunting strategy as a modus operandi.</p><p><a href="/assets/e3a6a1939162/1*hwHo7jZsENEwPpjpFR8T7A.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*hwHo7jZsENEwPpjpFR8T7A.png" alt="[The first tweet about Babuk ransomware](https://twitter.com/arkbird_solg/status/1345569395725242373?s=21){:target=&quot;_blank&quot;}" loading="lazy"></a></p><p><a href="https://twitter.com/arkbird_solg/status/1345569395725242373?s=21" target="_blank">The first tweet about Babuk ransomware</a></p><p>Right after the attack on Washington D.C Police Department in April, the group announced they wanted to change direction, passing from RaaS to data-theft extortion and eventually becoming open-source.</p><p>In September of the same year, the ransomware source code was leaked and became available to the broad public, advised by the notorious malware database vx-underground:</p><p><a href="/assets/e3a6a1939162/1*muSDjoBE3pUM0zrO-YeQtQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*muSDjoBE3pUM0zrO-YeQtQ.png" alt="[vx-underground advises the source code leak](https://mobile.twitter.com/vxunderground/status/1433758742244478982){:target=&quot;_blank&quot;}" loading="lazy"></a></p><p><a href="https://mobile.twitter.com/vxunderground/status/1433758742244478982" target="_blank">vx-underground advises the source code leak</a></p><p>The malware shares part of its codebase with <em>Vasa Locker</em> , <em>Rook</em> , and <em>DarkAngels</em> ransomwares, and despite the group announcements, its encryption capabilities were enhanced, becoming more efficient during the whole year 2021.</p><p><a href="/assets/e3a6a1939162/1*B8h5sVamTGyAdvVIJJva4A.jpeg" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*B8h5sVamTGyAdvVIJJva4A.jpeg" alt="Babuk codebase inheritance tree" loading="lazy"></a></p><p>Babuk codebase inheritance tree</p><h3 id="the-sample-"><span class="me-2">The sample :</span><a href="#the-sample-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We are going to perform <strong>basic</strong> and <strong>advanced</strong> <strong>static analysis</strong> of the sample <strong>Babuk v4</strong> , you can find it at this <a href="https://bazaar.abuse.ch/sample/245e191bfe998ad9ef2d6b169af22f3c290e9950234f8ddd0f4a03cb3eebf761/" target="_blank">link</a> .</p><blockquote><p><strong>MD5</strong> :</p></blockquote><blockquote><p>a499f810c2e52fe9f8adcd5817b2d985</p></blockquote><blockquote><p><strong>SHA256</strong> : 245e191bfe998ad9ef2d6b169af22f3c290e9950234f8ddd0f4a03cb3eebf761</p></blockquote><p>Opening the sample with <em>pestudio</em> , we notice that it is importing a wide selection of flagged functions.</p><p><a href="/assets/e3a6a1939162/1*QHxNAp9Bepgbl5210o03HA.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*QHxNAp9Bepgbl5210o03HA.png" alt="pestudio imported functions tab" loading="lazy"></a></p><p>pestudio imported functions tab</p><p>The summary from <a href="https://www.radare.org/cutter/" target="_blank"><strong><em>Cutter</em></strong></a> <strong>:</strong></p><p><a href="/assets/e3a6a1939162/1*RCOG5yXu0jZ3Cgc9urM1ew.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*RCOG5yXu0jZ3Cgc9urM1ew.png" alt="Cutter summary dashboard" loading="lazy"></a></p><p>Cutter summary dashboard</p><p><a href="/assets/e3a6a1939162/1*dGFZciZyOymoSNYxZTo88Q.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*dGFZciZyOymoSNYxZTo88Q.png" alt="**DIE** entropy tab" loading="lazy"></a></p><p><strong>DIE</strong> entropy tab</p><p>The static analysis done by <em>Detect It Easy</em> suggests that the sample is <strong>not packed</strong> . So we can search at the Symbols Tree and open the view to the decompiled code of the <strong>entry0 function:</strong></p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">entry0</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">cVar1</span><span class="p">;</span>
    <span class="n">undefined4</span> <span class="n">uVar2</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">iVar3</span><span class="p">;</span>
    <span class="n">undefined4</span> <span class="n">lpSystemInfo</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_74h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_64h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_60h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_5ch</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_58h</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">var_54h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_50h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_4ch</span><span class="p">;</span>
    <span class="n">undefined4</span> <span class="n">lpString1</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">var_44h</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">var_40h</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">hObject</span><span class="p">;</span>
    <span class="n">undefined4</span> <span class="n">var_38h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_34h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_30h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_2ch</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_28h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_24h</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">var_20h</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">lpHandles</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_18h</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="o">*</span><span class="n">var_14h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">var_10h</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">lpString2</span><span class="p">;</span>
    <span class="kt">int32_t</span> <span class="n">lpString</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">nCount</span><span class="p">;</span>
    
    <span class="n">fcn</span><span class="mf">.0040f</span><span class="n">de0</span><span class="p">();</span>
    <span class="n">fcn</span><span class="mf">.00412</span><span class="n">d80</span><span class="p">();</span>
    <span class="o">*</span><span class="p">(</span><span class="kt">int32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x414260</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00404</span><span class="n">a80</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x414260</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">var_18h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">uVar2</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_GetCommandLineW</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">var_18h</span><span class="p">);</span>
        <span class="n">var_38h</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_CommandLineToArgvW</span><span class="p">)(</span><span class="n">uVar2</span><span class="p">);</span>
        <span class="p">(</span><span class="o">*</span><span class="n">_SetProcessShutdownParameters</span><span class="p">)(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">var_44h</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00404</span><span class="n">c20</span><span class="p">(</span><span class="n">var_18h</span><span class="p">,</span> <span class="n">var_38h</span><span class="p">,</span> <span class="mh">0x403c18</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">var_44h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x414130</span> <span class="o">=</span> <span class="n">var_44h</span><span class="p">;</span>
            <span class="n">fcn</span><span class="mf">.00404</span><span class="n">dc0</span><span class="p">(</span><span class="n">var_44h</span><span class="p">);</span>
            <span class="o">*</span><span class="p">(</span><span class="kt">int32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x41425c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">fcn</span><span class="mf">.00404770</span><span class="p">();</span>
        <span class="n">fcn</span><span class="mf">.004049</span><span class="n">b0</span><span class="p">();</span>
        <span class="n">fcn</span><span class="mf">.004046</span><span class="n">d0</span><span class="p">();</span>
        <span class="p">(</span><span class="o">*</span><span class="n">_SHEmptyRecycleBinA</span><span class="p">)(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
        <span class="p">(</span><span class="o">*</span><span class="n">_GetSystemInfo</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">lpSystemInfo</span><span class="p">);</span>
        <span class="n">var_5ch</span> <span class="o">=</span> <span class="n">var_74h</span><span class="p">;</span>
        <span class="n">var_54h</span> <span class="o">=</span> <span class="n">var_74h</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">nCount</span> <span class="o">=</span> <span class="n">var_54h</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">fcn</span><span class="mf">.00412e50</span><span class="p">(</span><span class="mh">0x4141fc</span><span class="p">,</span> <span class="n">var_74h</span> <span class="o">*</span> <span class="mh">0x18</span><span class="p">);</span>
        <span class="n">fcn</span><span class="mf">.00412e50</span><span class="p">(</span><span class="mh">0x41422c</span><span class="p">,</span> <span class="n">nCount</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
        <span class="n">lpHandles</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00412e00</span><span class="p">(</span><span class="n">nCount</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">var_20h</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00412e00</span><span class="p">(</span><span class="n">nCount</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">lpHandles</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">var_20h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">fcn</span><span class="mf">.00412</span><span class="n">d90</span><span class="p">(</span><span class="n">lpHandles</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nCount</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">fcn</span><span class="mf">.00412</span><span class="n">d90</span><span class="p">(</span><span class="n">var_20h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nCount</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">var_24h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">var_24h</span> <span class="o">&lt;</span> <span class="n">nCount</span><span class="p">;</span> <span class="n">var_24h</span> <span class="o">=</span> <span class="n">var_24h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">uVar2</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_CreateThread</span><span class="p">)(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fcn</span><span class="mf">.0040</span><span class="n">a7e0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="o">*</span><span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)(</span><span class="n">lpHandles</span> <span class="o">+</span> <span class="n">var_24h</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">uVar2</span><span class="p">;</span>
                <span class="n">uVar2</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_CreateThread</span><span class="p">)(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fcn</span><span class="mf">.0040</span><span class="n">a7e0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="o">*</span><span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)(</span><span class="n">var_20h</span> <span class="o">+</span> <span class="n">var_24h</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">uVar2</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">lpString2</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00404</span><span class="n">c20</span><span class="p">(</span><span class="n">var_18h</span><span class="p">,</span> <span class="n">var_38h</span><span class="p">,</span> <span class="mh">0x403c24</span><span class="p">);</span>
            <span class="n">lpString</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00404</span><span class="n">c20</span><span class="p">(</span><span class="n">var_18h</span><span class="p">,</span> <span class="n">var_38h</span><span class="p">,</span> <span class="mh">0x403c34</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lpString2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">var_2ch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">var_60h</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_lstrlenW</span><span class="p">)(</span><span class="n">lpString2</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">var_28h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">var_28h</span> <span class="o">&lt;</span> <span class="n">var_60h</span><span class="p">;</span> <span class="n">var_28h</span> <span class="o">=</span> <span class="n">var_28h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int16_t</span> <span class="o">*</span><span class="p">)(</span><span class="n">lpString2</span> <span class="o">+</span> <span class="n">var_28h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x2c</span><span class="p">)</span> <span class="p">{</span>
                        <span class="o">*</span><span class="p">(</span><span class="n">undefined2</span> <span class="o">*</span><span class="p">)(</span><span class="n">lpString2</span> <span class="o">+</span> <span class="n">var_28h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                        <span class="n">var_2ch</span> <span class="o">=</span> <span class="n">var_2ch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">do</span> <span class="p">{</span>
                    <span class="n">iVar3</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_lstrlenW</span><span class="p">)(</span><span class="n">lpString2</span><span class="p">);</span>
                    <span class="n">lpString1</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00412e00</span><span class="p">(</span><span class="n">iVar3</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
                    <span class="p">(</span><span class="o">*</span><span class="n">_lstrcpyW</span><span class="p">)(</span><span class="n">lpString1</span><span class="p">,</span> <span class="n">lpString2</span><span class="p">);</span>
                    <span class="n">fcn</span><span class="mf">.0040</span><span class="n">a9a0</span><span class="p">(</span><span class="n">lpString1</span><span class="p">);</span>
                    <span class="n">fcn</span><span class="mf">.00412e30</span><span class="p">(</span><span class="n">lpString1</span><span class="p">);</span>
                    <span class="n">iVar3</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_lstrlenW</span><span class="p">)(</span><span class="n">lpString2</span><span class="p">);</span>
                    <span class="n">lpString2</span> <span class="o">=</span> <span class="n">lpString2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">iVar3</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="n">var_2ch</span> <span class="o">=</span> <span class="n">var_2ch</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">var_2ch</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lpString</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">var_34h</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">var_64h</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_lstrlenW</span><span class="p">)(</span><span class="n">lpString</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">var_30h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">var_30h</span> <span class="o">&lt;</span> <span class="n">var_64h</span><span class="p">;</span> <span class="n">var_30h</span> <span class="o">=</span> <span class="n">var_30h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int16_t</span> <span class="o">*</span><span class="p">)(</span><span class="n">lpString</span> <span class="o">+</span> <span class="n">var_30h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x2c</span><span class="p">)</span> <span class="p">{</span>
                        <span class="o">*</span><span class="p">(</span><span class="n">undefined2</span> <span class="o">*</span><span class="p">)(</span><span class="n">lpString</span> <span class="o">+</span> <span class="n">var_30h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                        <span class="n">var_34h</span> <span class="o">=</span> <span class="n">var_34h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">do</span> <span class="p">{</span>
                    <span class="n">iVar3</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_lstrlenW</span><span class="p">)(</span><span class="n">lpString</span><span class="p">);</span>
                    <span class="n">var_14h</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint16_t</span> <span class="o">*</span><span class="p">)</span><span class="n">fcn</span><span class="mf">.00412e00</span><span class="p">(</span><span class="n">iVar3</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
                    <span class="p">(</span><span class="o">*</span><span class="n">_lstrcpyW</span><span class="p">)(</span><span class="n">var_14h</span><span class="p">,</span> <span class="n">lpString</span><span class="p">);</span>
                    <span class="n">iVar3</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_lstrlenW</span><span class="p">)(</span><span class="n">var_14h</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">iVar3</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">var_14h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x3a</span><span class="p">))</span> <span class="p">{</span>
                        <span class="n">fcn</span><span class="mf">.0040</span><span class="n">aad0</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">*</span><span class="n">var_14h</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">fcn</span><span class="mf">.0040</span><span class="n">a5e0</span><span class="p">(</span><span class="n">var_14h</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="n">fcn</span><span class="mf">.00412e30</span><span class="p">(</span><span class="n">var_14h</span><span class="p">);</span>
                    <span class="n">iVar3</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_lstrlenW</span><span class="p">)(</span><span class="n">lpString</span><span class="p">);</span>
                    <span class="n">lpString</span> <span class="o">=</span> <span class="n">lpString</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">iVar3</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="n">var_34h</span> <span class="o">=</span> <span class="n">var_34h</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">var_34h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(((</span><span class="n">lpString</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">lpString2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">iVar3</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_OpenMutexA</span><span class="p">)(</span><span class="mh">0x1f0001</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x403c40</span><span class="p">),</span> <span class="n">iVar3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
                <span class="p">(</span><span class="o">*</span><span class="n">_CreateMutexA</span><span class="p">)(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x403c60</span><span class="p">);</span>
                <span class="n">var_58h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">cVar1</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00404</span><span class="n">b20</span><span class="p">(</span><span class="n">var_18h</span><span class="p">,</span> <span class="n">var_38h</span><span class="p">,</span> <span class="mh">0x403c80</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x01'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">fcn</span><span class="mf">.0040</span><span class="n">a8d0</span><span class="p">(</span><span class="n">var_58h</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">fcn</span><span class="mf">.004044</span><span class="n">a0</span><span class="p">();</span>
                <span class="n">var_40h</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">_GetLogicalDrives</span><span class="p">)();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">var_40h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">var_10h</span><span class="p">.</span><span class="n">_0_2_</span> <span class="o">=</span> <span class="mh">0x41</span><span class="p">;</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">var_10h</span> <span class="o">&lt;</span> <span class="mh">0x5b</span><span class="p">;</span> <span class="n">var_10h</span><span class="p">.</span><span class="n">_0_2_</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">var_10h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">var_40h</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">fcn</span><span class="mf">.0040</span><span class="n">aad0</span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">var_10h</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="n">var_40h</span> <span class="o">=</span> <span class="n">var_40h</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">cVar1</span> <span class="o">=</span> <span class="n">fcn</span><span class="mf">.00404</span><span class="n">b20</span><span class="p">(</span><span class="n">var_18h</span><span class="p">,</span> <span class="n">var_38h</span><span class="p">,</span> <span class="mh">0x403c88</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">fcn</span><span class="mf">.0040</span><span class="n">a8d0</span><span class="p">(</span><span class="n">var_58h</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">var_4ch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">var_4ch</span> <span class="o">&lt;</span> <span class="n">nCount</span><span class="p">;</span> <span class="n">var_4ch</span> <span class="o">=</span> <span class="n">var_4ch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fcn</span><span class="mf">.00412f</span><span class="mi">70</span><span class="p">(</span><span class="mh">0x41422c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="p">(</span><span class="o">*</span><span class="n">_WaitForMultipleObjects</span><span class="p">)(</span><span class="n">nCount</span><span class="p">,</span> <span class="n">lpHandles</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">var_50h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">var_50h</span> <span class="o">&lt;</span> <span class="n">nCount</span><span class="p">;</span> <span class="n">var_50h</span> <span class="o">=</span> <span class="n">var_50h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fcn</span><span class="mf">.00412f</span><span class="mi">70</span><span class="p">(</span><span class="mh">0x4141fc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="p">(</span><span class="o">*</span><span class="n">_WaitForMultipleObjects</span><span class="p">)(</span><span class="n">nCount</span><span class="p">,</span> <span class="n">var_20h</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>
            <span class="n">fcn</span><span class="mf">.004046</span><span class="n">d0</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">hObject</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">hObject</span> <span class="o">&lt;</span> <span class="n">nCount</span><span class="p">;</span> <span class="n">hObject</span> <span class="o">=</span> <span class="n">hObject</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">(</span><span class="o">*</span><span class="n">_CloseHandle</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)(</span><span class="n">lpHandles</span> <span class="o">+</span> <span class="n">hObject</span> <span class="o">*</span> <span class="mi">4</span><span class="p">));</span>
                <span class="p">(</span><span class="o">*</span><span class="n">_CloseHandle</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)(</span><span class="n">var_20h</span> <span class="o">+</span> <span class="n">hObject</span> <span class="o">*</span> <span class="mi">4</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">fcn</span><span class="mf">.00412e30</span><span class="p">(</span><span class="n">lpHandles</span><span class="p">);</span>
            <span class="n">fcn</span><span class="mf">.00412e30</span><span class="p">(</span><span class="n">var_20h</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x41425c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fcn</span><span class="mf">.00404e00</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="p">(</span><span class="o">*</span><span class="n">_CryptReleaseContext</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="kt">int32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x414260</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">(</span><span class="o">*</span><span class="n">_ExitProcess</span><span class="p">)(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="advanced-static-analysis"><span class="me-2">Advanced Static Analysis</span><a href="#advanced-static-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After analyzing the malware code, we can divide the malware activities into the following phases:</p><ul><li>It will start by <strong>obtaining the cryptographic key context</strong> and will increase the process completion time of the computer shutdown process.<li>Later, it will <strong>terminate</strong> a predefined list of <strong>services and processes,</strong> <strong>delete</strong> <strong>shadow copies</strong> , and <strong>empty</strong> the <strong>recycle bin</strong> .<li>After that, it will <strong>create</strong> several <strong>threads</strong> (which it will use to traverse and encrypt later); it will <strong>discover</strong> <strong>shared folders, network resources</strong> , and <strong>disks</strong> to know what it can and cannot encrypt (managing exclusion lists too)<li>Finally, it will <strong>encrypt</strong> <strong>everything</strong> and create the ransom file in each encrypted folder.</ul><h3 id="obtaining-key-context"><span class="me-2">Obtaining Key Context</span><a href="#obtaining-key-context" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In the beginning, Babuk uses the <em>acquire_CSP</em> function that calls the <em>CryptAcquireContextW</em> API to get an handle to a key container within a Cryptographic Service Provider (CSP) .</p><p><a href="/assets/e3a6a1939162/1*f9Lo8YBSLKtWLZpQ5ZEOyw.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*f9Lo8YBSLKtWLZpQ5ZEOyw.png" alt="Babuk obtains the handle to the **CSP**" loading="lazy"></a></p><p>Babuk obtains the handle to the <strong>CSP</strong></p><p>Next, the malware parses the command line arguments and calls the <em>SetProcessShutdownParameters</em> API to increase the time the malware gets to execute in the compromised machine.</p><p><a href="/assets/e3a6a1939162/1*5LJFmOhWysXA87n5Tn7dTw.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*5LJFmOhWysXA87n5Tn7dTw.png" alt="" loading="lazy"></a></p><h3 id="terminating-services-and-processes"><span class="me-2">Terminating Services and Processes</span><a href="#terminating-services-and-processes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Than Babuk attempts to close a predefined list of the <strong>services</strong> and <strong>processes</strong> :</p><h4 id="services"><span class="me-2"><strong>Services</strong></span><a href="#services" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p>vss, sql, svc, memtas, mepocs, sophos, veeam, backup, GxVss, GxBlr, GxFWD, GxCVD, GxCIMgr, DefWatch, ccEvtMgr, ccSetMgr, SavRoam, RTVscan, QBFCService, QBIDPService, Intuit.QuickBooks.FCS, QBCFMonitorService, YooBackup, YooIT, zhudongfangyu, sophos, stc_raw_agent, VSNAPVSS, VeeamTransportSvc, VeeamDeploymentService, VeeamNFSSvc, veeam, DVFSService, BackupExecVSSProvider, BackupExecAgentAccelerator, BackupExecAgentBrowser, BackupExecDiveciMediaService, BackupExecJobEngine, BackupExecManagementService, BackupExecRPCService, AcrSch2Svc, AcronisAgent, CASAD2DWebSvc, CAARCUpdateSvc.</p></blockquote><p>The malware obtains a handle to the <em>SCManager</em> with the function <em>OpenSCManagerA</em> . Then, it opens and checks the status of the services by calling <em>QueryServiceStatusEx</em> . If the service is still running, it will enumerate the services that depend on it by calling <em>EnumDependentServicesA</em> , so it will first <strong>stop</strong> all the <strong>dependent</strong> <strong>services</strong> <strong>and</strong> finally the <strong>targetted</strong> <strong>one</strong> , always calling the ControlService function with the <em>SERVICE_CONTROL_STOP</em> flag.</p><p><a href="/assets/e3a6a1939162/1*S1ufaYYZGItDrhO6VDIZAg.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*S1ufaYYZGItDrhO6VDIZAg.png" alt="Babuk stops all the dependent services of the target service." loading="lazy"></a></p><p>Babuk stops all the dependent services of the target service.</p><h4 id="processes"><span class="me-2">Processes</span><a href="#processes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p>sql.exe, oracle.exe, ocssd.exe, dbsnmp.exe, synctime.exe, agntsvc.exe, isqlplussvc.exe, xfssvccon.exe, mydesktopservice.exe, ocautoupds.exe, encsvc.exe, firefox.exe, tbirdconfig.exe, mydesktopqos.exe, ocomm.exe, dbeng50.exe, sqbcoreservice.exe, excel.exe, infopath.exe, msaccess.exe, mspub.exe, onenote.exe, outlook.exe, powerpnt.exe, steam.exe, thebat.exe, thunderbird.exe, visio.exe, winword.exe, wordpad.exe, notepad.exe,</p></blockquote><p>Than Babuk uses <em>CreateToolhelp32Snapshot</em> , <em>Process32FirstW</em> , <em>Process32NextW</em> , <em>OpenProcess</em> , and <em>TerminateProcess</em> to enumerate running processes and kill any found to match those in the hardcoded list.</p><p><a href="/assets/e3a6a1939162/1*W91xSBPGmDHGw-A7-4zVlg.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*W91xSBPGmDHGw-A7-4zVlg.png" alt="Babuk terminates the processes matching the list." loading="lazy"></a></p><p>Babuk terminates the processes matching the list.</p><h4 id="delete-shadow-copy"><span class="me-2">Delete Shadow Copy</span><a href="#delete-shadow-copy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The malwareâ€™s following action is deleting the victim machineâ€™s shadow volumes in this way:</p><ul><li>It disables system redirection using <em>Wow64DisableWow64FsRedirection,</em><li>Then calls <em>ShellExecuteW</em> to execute the command <strong>â€œcmd.exe /c vssadmin.exe delete shadows /all /quietâ€</strong> <em>,</em> which removes the shadow volumes,<li>Finally employs <em>Wow64RevertWow64FsRedirection</em> to re-enable file system redirection.</ul><p><a href="/assets/e3a6a1939162/1*4dEo4B6bza7u0n-1vT9XqQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*4dEo4B6bza7u0n-1vT9XqQ.png" alt="Babuk deletes the **shadow volumes**" loading="lazy"></a></p><p>Babuk deletes the <strong>shadow volumes</strong></p><p>Lastly, Babuk empties the content of recycle bin using the function <em>SHEmptyRecycleBinA</em> <strong>.</strong></p><p><a href="/assets/e3a6a1939162/1*nbuibdguB5JRHk73Oujezg.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*nbuibdguB5JRHk73Oujezg.png" alt="Babuk empties the **recycle bin**" loading="lazy"></a></p><p>Babuk empties the <strong>recycle bin</strong></p><h3 id="enumerating-shares-paths-and-resources"><span class="me-2">Enumerating Shares, Paths and Resources</span><a href="#enumerating-shares-paths-and-resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="shares"><span class="me-2">Shares</span><a href="#shares" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Babuk uses the optional arguments <em>shares</em> to enumerate specific network shares.</p><p><a href="/assets/e3a6a1939162/1*ADJfvQ6VglK8MDoivBY-vQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*ADJfvQ6VglK8MDoivBY-vQ.png" alt="Babuk parses command line arguments **shares** and **paths**" loading="lazy"></a></p><p>Babuk parses command line arguments <strong>shares</strong> and <strong>paths</strong></p><p>The share discovery employs the API <em>NetShareEnum,</em> which returns an array of <a href="https://docs.microsoft.com/en-us/windows/desktop/api/lmshare/ns-lmshare-share_info_0" target="_blank">SHARE_INFO_0</a> structures, then parses searching for <em>ADMIN$</em> shares.</p><p><a href="/assets/e3a6a1939162/1*FWSH7KG6XpkXJLz92W91og.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*FWSH7KG6XpkXJLz92W91og.png" alt="Babuk checks **ADMIN$ share**" loading="lazy"></a></p><p>Babuk checks <strong>ADMIN$ share</strong></p><p>If the check is positive, it calls the <em>find_paths_recursive</em> function, which operates partially like the <em>find_files_recurisive</em> function <em>,</em> pushing the path to the queue. Then popping and encrypting the files it founds enqueued, proceeding with a recursive call in case it finds other directories.</p><p><a href="/assets/e3a6a1939162/1*uZMjt_twxmYis8S6qjOLoA.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*uZMjt_twxmYis8S6qjOLoA.png" alt="**find_paths_recursive** routine push, pop and encrypt files" loading="lazy"></a></p><p><strong>find_paths_recursive</strong> routine push, pop and encrypt files</p><h4 id="paths"><span class="me-2">Paths</span><a href="#paths" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Babuk does the same with the command line argument <em>paths</em> , used to explore specific filesystem locations, manipulating the path appropriately if it contains a Drive, and then using the <em>find_paths_recursive</em> routine as in the previous case.</p><p><a href="/assets/e3a6a1939162/1*9XfotuD50nutSE7YwMjVFg.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*9XfotuD50nutSE7YwMjVFg.png" alt="Babuk checks if the current path is a drive" loading="lazy"></a></p><p>Babuk checks if the current path is a drive</p><h4 id="mutex"><span class="me-2">Mutex</span><a href="#mutex" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>After the enumeration of shares and paths, the malware checks and creates a mutex named <em>DoYouWantToHaveSexWithCuongDong</em> to avoid starting the encryption if the target is already infected.</p><p><a href="/assets/e3a6a1939162/1*vLpZQ1eyT_of150k2o3Kkg.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*vLpZQ1eyT_of150k2o3Kkg.png" alt="Babuck opens and creates a mutex" loading="lazy"></a></p><p>Babuck opens and creates a mutex</p><h4 id="resources"><span class="me-2">Resources</span><a href="#resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In the case attacker specifies the argument <em>sf</em> in the command line, Babuk proceeds to enumerate network resources, using the <em>find_files_network</em> that employs the standard Windows APIs <em>WNetOpenEnumW</em> and <em>WNetEnumResourceW,</em> calling the find_files_network and <em>find_paths_recursive</em> routines recursively.</p><p><a href="/assets/e3a6a1939162/1*Ig0Erlp-Q3CqC50PepbzsQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*Ig0Erlp-Q3CqC50PepbzsQ.png" alt="Babuk parses the **sf** argument" loading="lazy"></a></p><p>Babuk parses the <strong>sf</strong> argument</p><p><a href="/assets/e3a6a1939162/1*cNlpLODi7YsHXtUIhiGAkw.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*cNlpLODi7YsHXtUIhiGAkw.png" alt="**find_files_network** routine enumerate the resources" loading="lazy"></a></p><p><strong>find_files_network</strong> routine enumerate the resources</p><p>Finally, Babuk waits for the encryption threads to terminate, calling the <em>WaitForMultipleObjects</em> API, and deletes the <em>shadow copies</em> again.</p><p><a href="/assets/e3a6a1939162/1*3pDJMfBKC6_T7GpTBA9rHA.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*3pDJMfBKC6_T7GpTBA9rHA.png" alt="Babuck waits the threads and removes the shadow volumes" loading="lazy"></a></p><p>Babuck waits the threads and removes the shadow volumes</p><p>Ultimately it closes the handles to the threads, releases the CSP, and exits, calling the Windows APIs <em>CloseHandle</em> , <em>CryptoReleaseContext</em> , and <em>ExitProcess.</em></p><p><a href="/assets/e3a6a1939162/1*PWb-D8gv1chfAkwZLDoiwQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*PWb-D8gv1chfAkwZLDoiwQ.png" alt="Babuk closes the handles to the threads, then releases the CSP and exits." loading="lazy"></a></p><p>Babuk closes the handles to the threads, then releases the CSP and exits.</p><h3 id="encrypt-everything"><span class="me-2">Encrypt Everything</span><a href="#encrypt-everything" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="threads-and-queue"><span class="me-2">Threads and queue</span><a href="#threads-and-queue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Babuk computes the <strong>number</strong> of <strong>threads</strong> for discovering and encrypting the target files and <strong>initializes</strong> a <strong>linked queue</strong> it will use to store them.</p><p><a href="/assets/e3a6a1939162/1*Y1aiHkn4IPOOIQ38i9U3dQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*Y1aiHkn4IPOOIQ38i9U3dQ.png" alt="Babuk creates the secondary threads" loading="lazy"></a></p><p>Babuk creates the secondary threads</p><p>The above code is executed inside a loop and creates two threads for each iteration. The thread points to the <em>babuk_thread_encrypt</em> routine that takes one parameter; if its value is 1, the thread will attempt to find the files recursively and then starts the encryption; if its value is 0, it will just begin encrypting the files it finds in the queue.</p><p><a href="/assets/e3a6a1939162/1*Nfp54OPnQeMc9fbKok63-A.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*Nfp54OPnQeMc9fbKok63-A.png" alt="The secondary threads start either encrypting or enumerating the files" loading="lazy"></a></p><p>The secondary threads start either encrypting or enumerating the files</p><p>The following drawing shows the way Babuk manages the linked queue:</p><p><a href="/assets/e3a6a1939162/1*hm0UuYYti5dx_6HzMF1BNQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*hm0UuYYti5dx_6HzMF1BNQ.png" alt="The operations on the linked queue" loading="lazy"></a></p><p>The operations on the linked queue</p><p>The <em>main thread</em> and the <em>slaves</em> push the clear-text files that will encrypt on the queue head; other <em>slaves</em> wait to pop them from the tail. In the <em>find_files_recurisve</em> function, <strong>the <em>Master</em></strong> <strong>and <em>slaves</em></strong> also <strong>create</strong> the <strong>ransom</strong> <strong>note</strong> file into the directory they traverse before the encryption unless the directory is in the <strong>deny list</strong> .</p><p><a href="/assets/e3a6a1939162/1*faEnhUybQb9yVUALJLA16g.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*faEnhUybQb9yVUALJLA16g.png" alt="Babuk creates the file â€œHow To Restore Your Files.txtâ€" loading="lazy"></a></p><p>Babuk creates the file â€œHow To Restore Your Files.txtâ€</p><p><a href="/assets/e3a6a1939162/1*XKPzlMYrzT1U2JEkPvCEug.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*XKPzlMYrzT1U2JEkPvCEug.png" alt="Babuk writes the hardcoded message to the file it just created" loading="lazy"></a></p><p>Babuk writes the hardcoded message to the file it just created</p><h4 id="ecryption"><span class="me-2">Ecryption</span><a href="#ecryption" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The encryption routine starts renaming the file that has to be encrypted by appending the <em>.babyk</em> extensions:</p><p><a href="/assets/e3a6a1939162/1*Pkb6YHlLKRkPJlDClAH_TQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*Pkb6YHlLKRkPJlDClAH_TQ.png" alt="Babuk renames the files by appending the â€œ **.babykâ€** extension." loading="lazy"></a></p><p>Babuk renames the files by appending the â€œ <strong>.babykâ€</strong> extension.</p><p>Upon successfully renaming the file, the ransomware generates the victimâ€™s public/private keys using the <a href="https://www.cryptopp.com/wiki/HC-128" target="_blank"><em>ChaCha</em></a> <em>HC-128 ECDH</em> algorithm.</p><ul><li>First, it <strong>obtains</strong> the 32 random bytes <strong>victimâ€™s <em>secret key</em></strong> by calling <em>CryptGenRandom</em> (which uses the CSP handle) .</ul><p><a href="/assets/e3a6a1939162/1*Xp4em_Srd5EXS3PwxKKWFw.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*Xp4em_Srd5EXS3PwxKKWFw.png" alt="Babuk generates 32 random bytes for the secret key" loading="lazy"></a></p><p>Babuk generates 32 random bytes for the secret key</p><ul><li><strong>Then</strong> , it <strong>adjusts</strong> the <strong><em>secret key</em></strong> with some â€œmagicâ€ bytes <strong>and</strong> <strong>uses</strong> the <a href="https://github.com/agl/curve25519-donna" target="_blank"><em>curve25519_donna</em></a> <strong>function</strong> to <strong>derive</strong> the <strong>victimâ€™s <em>public key</em></strong> (needed for the decryption) <em>.</em><li>Finally <strong>feeds</strong> the <strong>attackerâ€™s <em>public key</em></strong> , which was hardcoded by the ransomware builder, <strong>to</strong> th <em>e <a href="https://github.com/agl/curve25519-donna" target="_blank">curve25519_donna</a></em> <strong>function</strong> , <strong>obtaining</strong> a <strong><em>shared key.</em></strong><li><strong>Hashing</strong> the result <strong>with</strong> <strong>SHA256</strong> <strong>provides</strong> the <strong>key</strong> <strong>for</strong> <strong>encrypting</strong> the <strong>files</strong> with the <strong>ChaCha</strong> schema <em>.</em></ul><p><a href="/assets/e3a6a1939162/1*o5hA8zUHa6KSlViY9c_Qkg.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*o5hA8zUHa6KSlViY9c_Qkg.png" alt="Babuk sets up the cryptographic keys" loading="lazy"></a></p><p>Babuk sets up the cryptographic keys</p><p>After the set up of the Keys, Babuk creates a structure to hold the encryption meta-data (victimâ€™s public key and its crc32 checksum) to be saved at the end of the encrypted file and proceeds to encrypt the files differentiating in 3 cases.</p><p>The following encryption routine fragments compares the result of the <em>SetFilePointerEx</em> function with the hex values 0x1400000 (around 20 MB), 0x500000 (about 5 MB), and 0 bytes to choose the size of the block to be encrypted.</p><p><a href="/assets/e3a6a1939162/1*L5Oi0IhgrgUJ3OAM6L-Ajg.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*L5Oi0IhgrgUJ3OAM6L-Ajg.png" alt="Babuk checks the file size against the hardcoded constants" loading="lazy"></a></p><p>Babuk checks the file size against the hardcoded constants</p><p>But the routine does not change substantially: It always uses <em>ReadFile</em> to read a variable amount of bytes in the target file, then encrypts the bytes by calling <em>chacha_encrypt,</em> and finally moves the pointer forwards.</p><p><a href="/assets/e3a6a1939162/1*uvD8_aKBuzjie0gud-7xvQ.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*uvD8_aKBuzjie0gud-7xvQ.png" alt="Babuk reads bytes, encrypts, and moves the file pointer" loading="lazy"></a></p><p>Babuk reads bytes, encrypts, and moves the file pointer</p><p>Last but not least, the last fragment of the routine appends the meta-data needed to decrypt the file. That is to say: the <strong>attackers</strong> need to <strong>save</strong> the <strong>victimâ€™s</strong> <strong><em>public</em></strong> <em><strong>key</strong></em> to <strong>recover</strong> the <strong><em>shared</em></strong> <em><strong>secret</strong></em> and <strong>reproduce</strong> the <strong><em>symmetric key.</em></strong></p><p><a href="/assets/e3a6a1939162/1*vnLXTtT1B_Giy7grQ8FN0A.png" class="popup img-link shimmer"><img src="/assets/e3a6a1939162/1*vnLXTtT1B_Giy7grQ8FN0A.png" alt="Babuk appends the victimâ€™s public key to the file as metadata" loading="lazy"></a></p><p>Babuk appends the victimâ€™s public key to the file as metadata</p><h3 id="last-remarks"><span class="me-2">Last Remarks</span><a href="#last-remarks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="conclusions"><span class="me-2">Conclusions</span><a href="#conclusions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Babuk is a simple ransomware in that it does not use any obfuscation to hide its IoCs and does not employ any evasion or anti-analysis technique. Moreover, security vendors know it, considering it shares its codebase with several other malicious campaigns; nevertheless, from the analysis, we had the chance to observe how RaaS software executes its TTPs during large-scale campaigns.</p><h4 id="yara-rule"><span class="me-2">Yara Rule</span><a href="#yara-rule" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><pre><code class="language-yara">rule BabukRansomwareV4 {
    meta:
        description = "YARA rule for Babuk Locker v.4 unpacked"
        reference = "https://medium.com/@dbragetti/babuk-v4-ransomware-e3a6a1939162"
        author = "@dbragetti"
        date = "2022-08-10"
        rule_version = "v1"
        malware_type = "Ransomware"
    strings:
        $arg_str1 = "shares" wide
        $arg_str2 = "paths" wide
        $arg_str3 = "sf" wide
        $str0= "delete shadows /all /quiet" wide
        $str2 = "How To Restore Your Files.txt" wide
        $str3 = "DoYouWantToHaveSexWithCuongDong"
        $str4 = ".babyk" wide
        $str5 = "ADMIN$" wide
        $pattern1 = {51003a005c00000057003a005c00000045003a005c00000052003a005c00000054003a005c00000059003a005c00000055003a005c00000049003a005c0000004f003a005c00000050003a005c00000041003a005c00000053003a005c00000044003a005c00000046003a005c00000047003a005c00000048003a005c0000004a003a005c0000004b003a005c0000004c003a005c0000005a003a005c00000058003a005c00000043003a005c00000056003a005c00000042003a005c0000004e003a005c0000004d003a005c000000}
    condition:
        all of ($str*) and all of ($arg_str*) and all of ($pattern*)
}
</code></pre><h4 id="references"><span class="me-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p><a href="https://twitter.com/arkbird_solg/status/1345569395725242373" target="_blank">https://twitter.com/arkbird_solg/status/1345569395725242373</a></p></blockquote><blockquote><p><a href="https://mobile.twitter.com/vxunderground/status/1433758742244478982" target="_blank">https://mobile.twitter.com/vxunderground/status/1433758742244478982</a></p></blockquote><blockquote><p><a href="https://www.mcafee.com/enterprise/en-us/assets/reports/rp-babuk-ransomware.pdf" target="_blank">https://www.mcafee.com/enterprise/en-us/assets/reports/rp-babuk-ransomware.pdf</a></p></blockquote><blockquote><p><a href="https://blog.cyble.com/2021/07/05/deep-dive-into-builder-of-notorious-babuk-ransomware/" target="_blank">https://blog.cyble.com/2021/07/05/deep-dive-into-builder-of-notorious-babuk-ransomware/</a></p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories//"></a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/babuk/" class="post-tag no-text-decoration" >babuk</a> <a href="/tags/malware-analysis/" class="post-tag no-text-decoration" >malware-analysis</a> <a href="/tags/ransomware/" class="post-tag no-text-decoration" >ransomware</a> <a href="/tags/malware/" class="post-tag no-text-decoration" >malware</a> <a href="/tags/raas/" class="post-tag no-text-decoration" >raas</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Babuk%20v4%20Ransomware%20-%20&url=https%3A%2F%2Fl3ragio.github.io%2Fposts%2Fe3a6a1939162%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Babuk%20v4%20Ransomware%20-%20&u=https%3A%2F%2Fl3ragio.github.io%2Fposts%2Fe3a6a1939162%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fl3ragio.github.io%2Fposts%2Fe3a6a1939162%2F&text=Babuk%20v4%20Ransomware%20-%20" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/685de7093e5/">Unpacking Malware</a><li class="text-truncate lh-lg"> <a href="/posts/a7953a82fd2b/">Kerberos</a><li class="text-truncate lh-lg"> <a href="/posts/393bf888b4e8/">Choose Your Words Carefully in the Era of Peace, the Era of Silence</a><li class="text-truncate lh-lg"> <a href="/posts/dacd4e915676/">Auto-GPTâ€Šâ€”â€ŠWelcome to the Botnet: Malware and Existential Threats of Autonomous, LLM-Powered, C&C</a><li class="text-truncate lh-lg"> <a href="/posts/e3a6a1939162/">Babuk v4 Ransomware</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/malware-analysis/">malware-analysis</a> <a class="post-tag btn btn-outline-primary" href="/tags/malware/">malware</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active-directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">ai</a> <a class="post-tag btn btn-outline-primary" href="/tags/artificial-intelligence/">artificial-intelligence</a> <a class="post-tag btn btn-outline-primary" href="/tags/asymmetric-encryption/">asymmetric-encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/auto-gpt/">auto-gpt</a> <a class="post-tag btn btn-outline-primary" href="/tags/babuk/">babuk</a> <a class="post-tag btn btn-outline-primary" href="/tags/colors/">colors</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/dacd4e915676/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1681322885" data-df="ll" > Apr 12, 2023 </time><h4 class="pt-0 my-2">Auto-GPTâ€Šâ€”â€ŠWelcome to the Botnet: Malware and Existential Threats of Autonomous, LLM-Powered, C&C</h4><div class="text-muted"><p>The rapid advancement of artificial intelligence has given rise to an array of powerful language models, such as OpenAIâ€™s GPT-4. Theseâ€¦</p></div></div></a></article><article class="col"> <a href="/posts/685de7093e5/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1661728326" data-df="ll" > Aug 29, 2022 </time><h4 class="pt-0 my-2">Unpacking Malware</h4><div class="text-muted"><p>In manual and automated ways</p></div></div></a></article><article class="col"> <a href="/posts/a7953a82fd2b/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1740757752" data-df="ll" > Feb 28, 2025 </time><h4 class="pt-0 my-2">Kerberos</h4><div class="text-muted"><p>Just another introduction to Kerberos</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"><div class="btn btn-outline-primary disabled" aria-label="Older"><p>-</p></div><a href="/posts/685de7093e5/" class="btn btn-outline-primary" aria-label="Newer" ><p>Unpacking Malware</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>Â© <time>2026</time> <a href="https://x.com/l3rag1">Davide Bragetti</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.<br/> Automatically sync posts from Medium with <a href="https://zhgchg.li/posts/en-medium-to-jekyll/" target="_blank">ZhgChg.Li</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/malware-analysis/">malware-analysis</a> <a class="post-tag btn btn-outline-primary" href="/tags/malware/">malware</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active-directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">ai</a> <a class="post-tag btn btn-outline-primary" href="/tags/artificial-intelligence/">artificial-intelligence</a> <a class="post-tag btn btn-outline-primary" href="/tags/asymmetric-encryption/">asymmetric-encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/auto-gpt/">auto-gpt</a> <a class="post-tag btn btn-outline-primary" href="/tags/babuk/">babuk</a> <a class="post-tag btn btn-outline-primary" href="/tags/colors/">colors</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
